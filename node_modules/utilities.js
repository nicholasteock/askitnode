// Utilities.js
// Contains utility functions

var crypto = require('crypto');

// Generates a random alphanumeric string with a specified length
var randomString = function(length) {
    var charSet = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
    	result 	= '';
    for (var i = length; i > 0; --i) result += charSet[Math.round(Math.random() * (charSet.length - 1))];
    return result;
};

// Checks if a time has expired from current time relative to a specified threshold in ms
var isExpired = function( timestamp, thresholdMs ) {
	var currentTime = new Date(),
		compareTime = new Date( timestamp );
	return (currentTime-thresholdMs) >= compareTime;
};

// Current hash strategy, hash salt param with MD5 to generate salt
// then SHA1 value with salt to generate hash
var generateHash = function( salt, value ) {
	var salt 	= crypto.createHash('md5').update(salt).digest('hex'),
		hash 	= crypto.createHmac( 'sha1', salt ).update(value).digest('hex'),
		hashObj = { salt: salt, hash: hash };
	return hashObj;
};





module.exports = {
	isExpired 		: isExpired,
	randomString 	: randomString,
	generateHash 	: generateHash
}